{% extends "base.html" %} 

{% block content %}
    <div class="span9">
        <h2>Pictures</h2>
        <div id="paginator-container">
            {% include "pictures/pagination.html" %}
        </div>
        <div id="image-container">
            {% include "pictures/list_partial.html" %}
        </div>
    </div>
    <div id="tags" class="span2">
        {% include "pictures/tags.html" %}
    </div>
    <br style="clear:both">

    <input type="hidden" id="static-url" value="{{STATIC_URL}}" />
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery.fancybox.css" type="text/css" media="screen" />
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/jquery.isotope.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.fancybox.pack.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tagcloud.js"></script>
    <script>
    $(window).load( function() {

        var tags = [];

        $('#paginator-container').on('click', 'a', function() {
            page = $(this).data('page');
            cur_page = $('#cur-page').val();
            $.ajax({
                'type': 'post',
                'url' : '/pictures/page/'+page+'/',
                'dataType' : 'json',
                'success' : function(data){
                    var $pictures = $(data.pictures_html);
                    $('.picture').remove();
                    $('#image-container').html(data.pictures_html);
                    //$('#image-container').isotope('insert', $pictures);
                    $('#paginator-container').html(data.paginator_html);
                    //$('#image-container').isotope('reLayout');
                    //$('.page'+cur_page).remove();
                    //$('#image-contianer').isotope('reloadItems');
                    //$('#image-container').isotope('reloadItems').isotope({sortBy : 'original-order'});
                },
                'error' : function(data){
                    alert("Server Error");
                }
            });
        });

        $('#tags').on('click', 'a', function() {
            self = $(this);
            page = $('#cur-page').val();
            cur_page = $('#cur-page').val();
            tag_index = $.inArray(self.data('tag'), tags);

            if( tag_index >= 0 ) {
                tags.splice(tag_index,1);
                self.removeClass('active-tag');
            } else {
                tags.push(self.data('tag'));
                self.addClass('active-tag');
            }

            $.ajax({
                'type': 'post',
                'url' : '/pictures/page/'+page+'/',
                'data': JSON.stringify(tags),
                'contentType' : 'application/json',
                'dataType' : 'json',
                'success' : function(data){
                    //var $pictures = $(data.pictures_html);
                    $('.picture').remove();
                    $('#image-container').html(data.pictures_html);
                    //$('#image-container').isotope('insert', $pictures);
                    $('#paginator-container').html(data.paginator_html);
                    //$('#image-contianer').isotope('reloadItems');
                    //$('#image-container').isotope('reloadItems').isotope({sortBy : 'original-order'});
                    //$('#image-container').isotope('reLayout');
                },
                'error' : function(data){
                    alert("Server Error");
                }
            });
        });


        $('#image-container').isotope({
            layoutMode: 'cellsByRow',
            cellsByRow: {
                rowHeight: 130,
                columnWidht: 150
            }
        });

        //$('#image-container').isotope('reLayout');

        $(".fancybox").fancybox();
    });
    </script>
{% endblock %}
